<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>test</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="http://s.4cm.com/ui/bootstrap4/css/bootstrap.min.css" />
    <link rel="stylesheet" href="http://s.4cm.com/ui/iconfont/bootstrap.css" />
    <script type="text/javascript" src="http://s.4cm.com/common/jquery/3.3.1.min.js"></script>
    <script type="text/javascript" src="http://s.4cm.com/ui/bootstrap4/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="http://s.4cm.com/ui/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css" />
    <script type="text/javascript" src="http://s.4cm.com/ui/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
    <script type="text/javascript" src="http://s.4cm.com/ui/bootstrap-datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js"></script>
    <link rel="stylesheet" href="http://s.4cm.com/ui/summernote/summernote-lite.css" />
    <script type="text/javascript" src="http://s.4cm.com/ui/summernote/summernote-lite.min.js"></script>
    <script type="text/javascript" src="http://s.4cm.com/ui/summernote/lang/summernote-zh-CN.js"></script>
    <link rel="stylesheet" href="http://s.4cm.com/frame/4cm/style.css" />
    <style>
        ul.tree, .tree ul{
            padding-left: 2em;
        }
        .tree li{
            list-style: none;
        }
    </style>
</head>
<body>
    <!-- 树形结构 -->
    <div class="container-row row">
        <div class="col-sm-1">
            <img src="" width="100%" height="100px">
            <button class="btn btn-sm btn-primary">修改</button>
            <button class="btn btn-sm btn-danger">删除</button>
        </div>
        <div class="col-sm-1">
            <img src="" width="100%" height="100px">
            <button class="btn btn-sm btn-primary">修改</button>
            <button class="btn btn-sm btn-danger">删除</button>
        </div>
        <div class="col-sm-1">
            <img src="" width="100%" height="100px">
            <button class="btn btn-sm btn-primary">修改</button>
            <button class="btn btn-sm btn-danger">删除</button>
        </div>
        <div class="col-sm-1">
            <img src="" width="100%" height="100px">
            <button class="btn btn-sm btn-primary">修改</button>
            <button class="btn btn-sm btn-danger">删除</button>
        </div>
        <div class="col-sm-1">
            <img src="" width="100%" height="100px">
            <button class="btn btn-sm btn-primary">修改</button>
            <button class="btn btn-sm btn-danger">删除</button>
        </div>
        <div class="col-sm-1">
            <img src="" width="100%" height="100px">
            <button class="btn btn-sm btn-primary">修改</button>
            <button class="btn btn-sm btn-danger">删除</button>
        </div>
        <div class="col-sm-1">
            <img src="" width="100%" height="100px">
            <button class="btn btn-sm btn-primary">修改</button>
            <button class="btn btn-sm btn-danger">删除</button>
        </div>
        <div class="col-sm-1">
            <img src="" width="100%" height="100px">
            <button class="btn btn-sm btn-primary">修改</button>
            <button class="btn btn-sm btn-danger">删除</button>
        </div>
        <div class="col-sm-1">
            <img src="" width="100%" height="100px">
            <button class="btn btn-sm btn-primary">修改</button>
            <button class="btn btn-sm btn-danger">删除</button>
        </div>
        <div class="col-sm-1">
            <img src="" width="100%" height="100px">
            <button class="btn btn-sm btn-primary">修改</button>
            <button class="btn btn-sm btn-danger">删除</button>
        </div>
        <div class="col-sm-1">
            <img src="" width="100%" height="100px">
            <button class="btn btn-sm btn-primary">修改</button>
            <button class="btn btn-sm btn-danger">删除</button>
        </div>
        <div class="col-sm-1">
            <img src="" width="100%" height="100px">
            <button class="btn btn-sm btn-primary">修改</button>
            <button class="btn btn-sm btn-danger">删除</button>
        </div>
        <div class="col-sm-1">
            <img src="" width="100%" height="100px">
            <button class="btn btn-sm btn-primary">修改</button>
            <button class="btn btn-sm btn-danger">删除</button>
        </div>
        <div class="col-sm-1">
            <img src="" width="100%" height="100px">
            <button class="btn btn-sm btn-primary">修改</button>
            <button class="btn btn-sm btn-danger">删除</button>
        </div>
        <div class="col-sm-1">
            <img src="" width="100%" height="100px">
            <button class="btn btn-sm btn-primary">修改</button>
            <button class="btn btn-sm btn-danger">删除</button>
        </div>
        <div class="col-sm-1">
            <img src="" width="100%" height="100px">
            <button class="btn btn-sm btn-primary">修改</button>
            <button class="btn btn-sm btn-danger">删除</button>
        </div>
    </div>

    <!-- 树形结构 -->
    <div class="container-row" style="display: none">
        <ul class="tree">
            <li>
                <p>
                    <span>1级</span>
                    <button class="btn btn-sm btn-success">新增</button>
                    <button class="btn btn-sm btn-primary">修改</button>
                    <button class="btn btn-sm btn-danger">删除</button>
                </p>
                <ul>
                    <li>
                        <p>
                            <span>2级</span>
                            <button class="btn btn-sm btn-success">新增</button>
                            <button class="btn btn-sm btn-primary">修改</button>
                            <button class="btn btn-sm btn-danger">删除</button>
                        </p>
                        <ul>
                            <li>
                                <p>
                                    <span>3级</span>
                                    <button class="btn btn-sm btn-success">新增</button>
                                    <button class="btn btn-sm btn-primary">修改</button>
                                    <button class="btn btn-sm btn-danger">删除</button>
                                </p>
                            </li>
                            <li>
                                <p>
                                    <span>3级</span>
                                    <button class="btn btn-sm btn-success">新增</button>
                                    <button class="btn btn-sm btn-primary">修改</button>
                                    <button class="btn btn-sm btn-danger">删除</button>
                                </p>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <p>
                            <span>2级</span>
                            <button class="btn btn-sm btn-success">新增</button>
                            <button class="btn btn-sm btn-primary">修改</button>
                            <button class="btn btn-sm btn-danger">删除</button>
                        </p>
                        <ul>
                            <li>
                                <p>
                                    <span>3级</span>
                                    <button class="btn btn-sm btn-success">新增</button>
                                    <button class="btn btn-sm btn-primary">修改</button>
                                    <button class="btn btn-sm btn-danger">删除</button>
                                </p>
                            </li>
                            <li>
                                <p>
                                    <span>3级</span>
                                    <button class="btn btn-sm btn-success">新增</button>
                                    <button class="btn btn-sm btn-primary">修改</button>
                                    <button class="btn btn-sm btn-danger">删除</button>
                                </p>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li>
                <p>
                    <span>1级</span>
                    <button class="btn btn-sm btn-success">新增</button>
                    <button class="btn btn-sm btn-primary">修改</button>
                    <button class="btn btn-sm btn-danger">删除</button>
                </p>
                <ul>
                    <li>
                        <p>
                            <span>2级</span>
                            <button class="btn btn-sm btn-success">新增</button>
                            <button class="btn btn-sm btn-primary">修改</button>
                            <button class="btn btn-sm btn-danger">删除</button>
                        </p>
                    </li>
                    <li>
                        <p>
                            <span>2级</span>
                            <button class="btn btn-sm btn-success">新增</button>
                            <button class="btn btn-sm btn-primary">修改</button>
                            <button class="btn btn-sm btn-danger">删除</button>
                        </p>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
</body>
</html>
<script>

    const App = {
        pages: {},
        /**
         * 页面对象(基本包含按钮组、表单、筛选器、表格、分页器)
         */
        page: {
            id: '',//页面ID
            formApiUrl: '',//表单接口
            dataApiUrl: '',//数据接口
            data: {
                page: 1,//当前页码
                onPageNum: 1,//每页记录数
                recordNum: 0,//总记录数
                pageSideNum: 2,//两侧显示的页码数量
                keys: [],//键名数组，键名索引和数据索引保持一致
                list: [],//列表数据
                thead: [],//表头信息
                listIdx: -1,//选定列对应的索引
				form: {},//表单信息
                filter: {},//过滤器信息
                actions: [],//表格操作
            },
            timerBasicParam: {//时间选择器基本参数(页面初始化后删掉)
                language: 'zh-CN',
                weekStart: 1,
                todayBtn: 1,
                todayHighlight: 1,
                autoclose: 1,
                maxView: 4,
                startView: 2,
                // format: 'yyyy-mm-dd',
                // minView: 1,
            },
            //检查是否保留关键字
            checkReservedKeywords: function(key){
                return ['id', 'formApiUrl', 'dataApiUrl', 'data', 'on', 'off', 'clean'].indexOf(key) >= 0;
            },
            //设置属性
            on: function (key, value) {
                if (!this.checkReservedKeywords(key)) {
                    if (this.hasOwnProperty(key) && typeof (this[key]) === 'function') {
                        let mapKey = `${key}_${parseInt(key, 32)}`;
                        if (!this.hasOwnProperty(mapKey)) {
                            this[mapKey] = [];
                            this[mapKey].push(this[key]);
                        }
                        this[mapKey].push(value);
                        this[key] = () => {
                            Object.keys(this[mapKey]).forEach(i => {
                                this[mapKey][i]();
                            })
                        }
                    } else {
                        this[key] = value;
                    }
                }
            },
            //移除属性
            off: function(key){
                if (!this.checkReservedKeywords(key)) {
                    delete this[key];
                    delete this[`${key}_${parseInt(key, 32)}`];
                }
            },
            //创建页面后清除无用属性
            clean: function () {
                delete this.timerBasicParam;
                delete this.renderBtnGroup;
                delete this.renderForm;
                delete this.renderFilter;
                delete this.setThead;
                delete this.setActions;
            },
            /**
             * 显示表单
             */
            showForm: function(data){
                Object.keys(this.data.form).forEach(key => {
                    let info = this.data.form[key],
                        newVal = data.hasOwnProperty(key) ? data[key] : info.default,
                        target = $('#' + this.id + 'form [name=' + key + ']');
                    //多选项
                    if(info.type == 'checkbox'){
                        this.data.form[key].value = [].concat(newVal);
                        target.removeAttribute('checked');
                        this.data.form[key].value.forEach(val => {
                            $('#' + this.id + 'form [name=' + key + '][value=' + val + ']').prop('checked', true);
                        });
                    }
                    //富文本
                    else if(info.type == 'html'){
                        target.summernote('code', newVal);
                    }
                    else{
                        this.data.form[key].value = newVal;
                        target.val(newVal);
                    }
                });
                $('#' + this.id + ' form').show();
            },
            /**
             * 隐藏表单
             */
            hideForm: function(){
                $('#' + this.id + ' form').hide();
            },
            /**
             * 提交表单
             */
            submitForm: function(){
                let postData = {};
                Object.keys(this.data.form).forEach(key => {
                    if(this.data.form[key].regex){
                        if(this.data.form[key].value.replace(this.data.form[key].regex, '') !== ''){
                            Dialog.show({
                                message: this.data.form[key].tips,
                            });
                        }
                    }
                    postData[key] = this.data.form[key].value;
                });
                $.post(
                    this.formApiUrl,
                    postData,
                    result => {
                        this.hideForm();
                    },
                    err => {
                        Dialog.show({
                            message: err.message,
                        });
                    }
                );
            },
            /**
             * 提交过滤
             */
            submitFilter: function(){
                let url = this.dataApiUrl;
                Object.keys(this.data.filter).forEach(key => {
                    url += '/' + key + '/' + this.data.filter[key].value;
                });
                url += '/page/' + this.data.page;
                console.log(url)
                $.get(
                    url,
                    result => {
                        this.data.keys = result.keys;
                        this.data.list = result.data;
                        this.data.recordNum = result.count ? result.count : result.data.length;
                        this.renderTable();
                    },
                    err => {
                        Dialog.show({
                            message: err.message,
                        });
                    }
                )
            },
            /**
             * 设置表头信息
             * @param cfg
             * [
             *     {
             *         key: '',//key
             *         name: '',//列名
             *         regex: '',//用来修正显示的正则表达式
             *         show: 1,//是否显示
             *     },xN
             * ]
             */
            setThead: function(cfg){
                let theadFilter,
                    html = '';
                Object.keys(cfg).forEach(i => {
                    let info = cfg[i];
                    info.regex = info.regex ? info.regex : '';
                    info.show = info.hasOwnProperty('show') ? info.show : 1;
                    this.data.thead[info.key] = info;
                    let checked = info.show ? 'checked="checked"' : '';
                    html += `<label><input type="checkbox" value="${info.key}" ${checked}>${info.name}</label>`;
                });
                //确定按钮
                html += '<button class="btn btn-primary">确定</button>';
                theadFilter = $(`<div class="container-row form-inline">${html}</div>`);
                theadFilter.find('input').each((i, e) => {
                    $(e).on('click', () => {
                        this.data.thead[$(e).val()].show = $(e).prop('checked') ? 1 : 0;
                    });
                });
                theadFilter.find('button').on('click', () => {this.renderTable()});
                $('#' + this.id).append(theadFilter);
            },
            /**
             * 设置表格动作
             * @param cfg
             * [
             *     {
             *         key: '',//key
             *         name: '',//列名
             *         class: '',//样式
             *         click: '',//点击事件(匿名函数无法调用page的数据)
             *     },xN
             * ]
             */
            setActions: function(cfg){
                Object.keys(cfg).forEach(i => {
                    let info = cfg[i];
                    this.data.actions[info.key] = {
                        name: info.name,
                        class: info.class ? info.class : '',
                        click: info.click ? info.click : '',
                    };
                });
            },
            /**
             * 渲染按钮组(页面初始化后删掉)
             * @param cfg
             * [
             *     {
             *         name: '',//名称
             *         class: '',//样式
             *         click: '',//点击事件(匿名函数无法调用page的数据)
             *     },xN
             * ]
             */
            renderBtnGroup: function (cfg) {
                let group = $('<div class="container-row"></div>');
                Object.keys(cfg).forEach(i => {
                    let btn = $(`<button class="btn btn-default ${cfg[i].class}">${cfg[i].name}</button>`);
                    if (cfg[i].click) {
                        btn.on('click', () => this[cfg[i].click]());
                    }
                    group.append(btn);
                });
                $('#' + this.id).append(group);
            },
            /**
             * 渲染表单(页面初始化后删掉)
             * @param cfg
			 * [
			 *     {
			 *         key: '',//表单元素的key
			 *         name: '',//表单元素的名字
			 *         type: '',//表单类型[select/hidden/text/textarea/password/radio/checkbox/number/tel/timer/html/files]
			 *         placeholder: '',//描述文字
			 *         options: {//选项(仅select/radio/checkbox类型用到)
			 *         		value: text, //选项值与提示文字键值对
			 *         },
			 *         unit: '',//单位描述(空表示没有单位)
			 *         value: '',//值(checkbox/files类型为数组)
			 *         default: '',//默认值(checkbox/files类型为数组)
			 *         regex: '',//检验值的正则表达式(空表示不校验)
			 *         tips: '',//校验不通过时的提示信息
			 *         format: '',//时间格式(仅timer类型用到)
			 *         column: 0,//所占列数(一行12列)
			 *     },xN
			 * ]
             */
            renderForm: function (cfg) {
                let form = $('<form class="container-row"></form>');
                let colNumOnRow = 0;//一行的列数
                let lastIdx = cfg.length - 1;//最后一个配置的索引
                let rowBox = $('<div class="row"></div>');
            	Object.keys(cfg).forEach(i => {
					let colBox,
                        html = '',
                        info = cfg[i];
					//校正参数
					info.name = info.hasOwnProperty('name') ? info.name : '';
					info.type = info.hasOwnProperty('type') ? info.type : 'text';
					info.placeholder = info.hasOwnProperty('placeholder') ? info.placeholder : '';
					info.options = info.hasOwnProperty('options') ? info.options : {};
					info.unit = info.hasOwnProperty('unit') ? info.unit : '';
					info.default = info.hasOwnProperty('default') ? info.default : '';
					info.regex = info.hasOwnProperty('regex') ? info.regex : '';
					info.tips = info.hasOwnProperty('tips') ? info.tips : '';
					info.format = info.hasOwnProperty('format') ? info.format : '';
					info.column = info.hasOwnProperty('column') ? info.column : 12;
					if(info.type == 'checkbox' && !Array.isArray(info.default)){
					    if(info.default !== ''){
                            info.default = [info.default.toString()];
                        }
						else{
                            info.default = [];
                        }
					}
                    info.value = info.default;
					//写到data的表单映射
            		this.data.form[info.key] = {
            		    type: info.type,
            			default: info.default,
						value: info.value,
						regex: info.regex,
						tips: info.tips,
					}
					//隐藏输入框只需要记录数据，不需要创建表单元素
					if(info.type == 'hidden'){
					    return ;
                    }
					//单选和多选
					if(['radio','checkbox'].indexOf(info.type) >= 0){
						Object.keys(info.options).forEach(key => {
						    let checked = '';
						    if((info.type == 'radio' && info.default == key)
                            || (info.type == 'checkbox' && info.default.indexOf(key) >= 0)){
						        checked = 'checked="checked"';
                            }
                            html += `<label>
                                    <input type="${info.type}" name="${info.key}" value="${key}" ${checked}>
                                    ${info.options[key]}
                                    </label>`;
						});
                        html = `<div class="form-multiselect-row">${html}</div>`;
					}
					//文本框和富文本
					else if(['textarea','html'].indexOf(info.type) >= 0){
					    let sign = info.type == 'html' ? 'editor="1"' : '';
					    html = `<textarea name="${info.key}" class="form-control" placeholder="${info.placeholder}" ${sign}>${info.value}</textarea>`;
                    }
                    //下拉选择框
					else if(info.type == 'select'){
                        Object.keys(info.options).forEach(key => {
                            let selected = info.default == key ? 'selected="selected"' : '';
                            html += `<option value="${key}" ${selected}>${info.options[key]}</option>`;
                        });
                        html = `<select name="${info.key}" class="form-control">${html}</select>`;
                    }
					//input输入框
                    else{
                        let appendHtml = '',
                            readOnly = info.type == 'timer' ? 'readOnly=true' : '';
                        if(info.unit){
                            appendHtml = `<div class="input-group-append">
                                                <span class="input-group-text">${info.unit}</span>
                                            </div>`;
                        }
                        html = `<div class="input-group">
                                    <input class="form-control" type="${info.type}" name="${info.key}"
                                    placeholder="${info.placeholder}" value="${info.value}" ${readOnly}>
                                     ${appendHtml}
                                </div>`;
                    }
					//创建列对象
					let colNum = info.column > 0 ? info.column : 12;
                    colBox = $(`<div class="col-sm-${colNum}">
                                    <label>${info.name}</label>
                                    ${html}
                                </div>`);
                    //绑定表单元素的change事件
                    colBox.find(`[name=${info.key}]`).each((j, e) => {
                        $(e).on('change', () => {
                            let value = $(e).val();
                            if(info.type == 'checkbox'){
                                if($(e).prop('checked')){
                                    this.data.form[info.key].value.push(value);
                                }
                                else{
                                    this.data.form[info.key].value.splice(
                                        this.data.form[info.key].value.indexOf(value), 1);
                                }
                            }
                            else{
                                this.data.form[info.key].value = value;
                            }
                        })
                    });
                    //初始化时间选择器
                    if(info.type == 'timer'){
                        this.timerBasicParam.minView = 2;
                        this.timerBasicParam.format = info.format ? info.format : 'yyyy-mm-dd';
                        if(/h/i.test(this.timerBasicParam.format)){
                            this.timerBasicParam.minView = 1;
                        }
                        colBox.find('input').datetimepicker(this.timerBasicParam);
                    }
                    //看一下应该放到哪一行
					colNumOnRow += colNum;
					if(colNumOnRow <= 12){
                        rowBox.append(colBox);
                    }
                    if(colNumOnRow >= 12 || i == lastIdx){
                        form.append(rowBox);
                        rowBox = $('<div class="row"></div>');
                        if(colNumOnRow > 12){
                            rowBox.append(colBox);
                            colNumOnRow = colNum;
                        }
                        else{
                            colNumOnRow = 0;
                        }
                    }
                    if(colNumOnRow >= 12 && i == lastIdx){
                        form.append(rowBox);
                    }
				});
            	//提交和取消按钮
                let actions = $('<div class="row">' +
                                '<div class="col-12">' +
                                    '<button name="submit" class="btn btn-success">提交</button>' +
                                    '<button name="cancel" class="btn btn-default">取消</button>' +
                                '</div>' +
                            '</div>');
                actions.find('[name=cancel]').on('click', () => {
                    this.hideForm();
                });
                form.append(actions);
                form.on('submit', (e) => {
                    e.preventDefault();
                    this.submitForm();
                });
                $('#' + this.id).append(form);
                //初始化富文本
                $('#' + this.id).find('[editor=1]').each((i, e) => {
                    $(e).summernote({
                        lang: 'zh-CN',
                        height: 150,
                        callbacks: {
                            onChange: (contents) => {
                                this.data.form[$(e).attr('name')].value = contents;
                            }
                        }
                    });
                });
            },
            /**
             * 渲染过滤器(页面初始化后删掉)
             * @param cfg
             * [
             *     {
             *         key: '',//key
             *         name: '',//名字
             *         type: 'text',//类型[select/text/timer/bool/button]
             *         placeholder: '',//描述文字
             *         options: {//选项(仅select可用)
             *         		value: text, //选项值与提示文字键值对
             *         },
             *         value: '',//值
             *         format: '',//时间格式(仅timer类型可用)
             *         click: 0,//点击事件(仅button类型可用)
             *         class: '',//样式名(bool类型默认flase使用btn-default,true使用btn-success)
             *     },xN
             * ]
             */
            renderFilter: function(cfg){
                let filter = $('<div class="container-row form-inline"></div>');
                Object.keys(cfg).forEach(i => {
                    let html = '',
                        label = '',
                        group = '',
                        info = cfg[i];
                    //校正参数
                    info.name = info.hasOwnProperty('name') ? info.name : '';
                    info.type = info.hasOwnProperty('type') ? info.type : 'text';
                    info.placeholder = info.hasOwnProperty('placeholder') ? info.placeholder : '';
                    info.options = info.hasOwnProperty('options') ? info.options : {};
                    info.value = info.hasOwnProperty('value') ? info.value : '';
                    info.format = info.hasOwnProperty('format') ? info.format : '';
                    info.click = info.hasOwnProperty('click') ? info.click : '';
                    info.class = info.hasOwnProperty('class') ? info.class : '';
                    //写到data的表单映射
                    this.data.filter[info.key] = {
                        type: info.type,
                        value: info.value,
                    }
                    //下拉选择框
                    if(info.type == 'select'){
                        Object.keys(info.options).forEach(key => {
                            let selected = info.value == key ? 'selected="selected"' : '';
                            html += `<option value="${key}" ${selected}>${info.options[key]}</option>`;
                        });
                        html = `<select name="${info.key}" class="form-control">${html}</select>`;
                    }
                    else if(['text','timer'].indexOf(info.type) >= 0){
                        let readOnly = info.type == 'timer' ? 'readOnly=true' : '';
                        html = `<input type="text" class="form-control" name="${info.key}"
                                    placeholder="${info.placeholder}" value="${info.value}" ${readOnly}>`;
                    }
                    else{
                        html = `<button name="${info.key}" class="btn btn-default ${info.class}">${info.name}</button>`;
                    }
                    if(info.name && ['bool','button'].indexOf(info.type) < 0){
                        label = `<label>${info.name}</label>`;
                    }
                    group = $(`<div class="form-group">${label}${html}</div>`);
                    //绑定事件
                    if(info.type == 'bool'){//布朗类型
                        group.find(`[name=${info.key}]`).on('click', e => {
                            if(info.value){
                                $(e.target).removeClass('btn-success');
                            }
                            else{
                                $(e.target).addClass('btn-success');
                            }
                            info.value = info.value ? 0 : 1;
                        });
                    }
                    else if(info.type == 'button'){//按钮
                        group.find(`[name=${info.key}]`).on('click', () => this[info.click]());
                    }
                    else{//其他
                        group.find(`[name=${info.key}]`).on('change', e => {
                            this.data.filter[info.key].value = e.target.value;
                        });
                    }
                    //初始化时间选择器
                    if(info.type == 'timer'){
                        this.timerBasicParam.minView = 2;
                        this.timerBasicParam.format = info.format ? info.format : 'yyyy-mm-dd';
                        if(/h/i.test(this.timerBasicParam.format)){
                            this.timerBasicParam.minView = 1;
                        }
                        group.find('input').datetimepicker(this.timerBasicParam);
                    }
                    filter.append(group);
                });
                //搜索按钮
                let submit = $('<div class="form-group">' +
                                    '<button name="submit" class="btn btn-primary">搜索</button>' +
                                '</div>');
                submit.find('button').on('click', () => {this.submitFilter()});
                filter.append(submit);
                $('#' + this.id).append(filter);
            },
            /**
             * 渲染表头过滤器
             */
            renderTable: function(){
                if(!$('#' + this.id).find('table').length){
                    $('#' + this.id).append(
                        $('<div class="table-responsive">' +
                                '<table class="table table-striped">' +
                                    '<thead>' +
                                        '<tr></tr>' +
                                    '</thead>' +
                                    '<tbody></tbody>' +
                                '</table>' +
                            '</div>'));
                }
                let table = $('#' + this.id).find('table');
                let keys = [];//本次渲染时要显示的key
                let actKeys = Object.keys(this.data.actions);
                //thead
                let thead = '';
                Object.keys(this.data.thead).forEach(key => {
                    if(this.data.thead[key].show){
                        thead += `<th>${this.data.thead[key].name}</th>`;
                        keys.push(key);
                    }
                });
                thead += '<th>操作</th>';
                table.find('thead tr').html(thead);
                //tbody
                let tbody = table.find('tbody');
                tbody.html('');
                Object.keys(this.data.list).forEach(i => {
                    let tr = $('<tr></tr>');
                    let td = $('<td></td>');
                    //数据列
                    keys.forEach(key => {
                        tr.append($(`<td>${this.data.list[i][this.data.keys.indexOf(key)]}</td>`));
                    });
                    //操作列
                    actKeys.forEach(key => {
                        let act = this.data.actions[key];
                        let btn = $(`<button name="${key}" class="btn btn-sm ${act.class}">${act.name}</button>`);
                        //绑定事件
                        btn.on('click', () => {
                            this.data.listIdx = i;
                            if(act.click){
                                this[act.click]();
                            }
                        });
                        td.append(btn);
                    });
                    tr.append(td);
                    tbody.append(tr);
                });
                this.renderPagination();
            },
            /**
             * 渲染分页器
             */
            renderPagination: function(){
                let maxPage = Math.ceil(this.data.recordNum / this.data.onPageNum);
                let html = this.getPageHtml(this.data.page, '', 'active');
                for(let i=1; i<=this.data.pageSideNum; i++){
                    html = this.getPageHtml(this.data.page - i) + html + this.getPageHtml(this.data.page + i);
                }
                if(this.data.page - this.data.pageSideNum > 1){
                    html = this.getPageHtml(1, '...', 'disabled') + html;
                    html = this.getPageHtml(1) + html;
                }
                if(this.data.page > 1){
                    html = this.getPageHtml(this.data.page - 1, '<') + html;
                }
                if(this.data.page + this.data.pageSideNum < maxPage){
                    html += this.getPageHtml(maxPage, '...', 'disabled');
                    html += this.getPageHtml(maxPage);
                }
                if(this.data.page < maxPage){
                    html += this.getPageHtml(this.data.page + 1, '>');
                }
                html = '<ul class="clearfix">' + html + '</ul>\n';
                $('#' + this.id + ' table').nextAll().remove();
                $('#' + this.id + ' table').closest('div').append($(html));
            },
            /**
             * 获取页码Html
             */
            getPageHtml: function(page, pageText, className){
                if(page < 1 || page > Math.ceil(this.data.recordNum / this.data.onPageNum)){
                    return '';
                }
                pageText = pageText ? pageText : page;
                className = className ? className : '';
                return '<li class="page-item ' + className +'">' +
                            '<a class="page-link" data-page="' + page + '" href="#">' + pageText + '</a>' +
                        '</li>';
            },
        },
        renderPage: function (page, config) {
            if (!this.pages.hasOwnProperty(page)) {
                $('body').append($(`<div id="${page}"></div>`));
                this.pages[page] = Object.assign({}, this.page);
                this.pages[page].id = page;
            }
            if (config.buttons) {
                this.pages[page].renderBtnGroup(config.buttons);
                delete config.buttons;
            }
            if (config.form){
                this.pages[page].renderForm(config.form);
                delete config.form;
            }
            if (config.filter){
                this.pages[page].renderFilter(config.filter);
                delete config.filter;
            }
            if (config.thead){
                this.pages[page].setThead(config.thead);
                delete config.thead;
            }
            if (config.actions){
                this.pages[page].setActions(config.actions);
                delete config.actions;
            }
            if (config.autoLoad){
                this.pages[page].submitFilter();
                delete config.autoLoad;
            }
            Object.keys(config).forEach(key => {
                this.pages[page].on(key, config[key]);
            });
            this.pages[page].clean();
        }
    }
    $(function () {
        // App.renderPage('apage', {
        // 	addNew: function(){
        // 		console.log('new2')
        // 	},
        // });
        // App.renderPage('bpage', {
        //     buttons: [
        //         {
        //             name: '新增',
        //             class: 'btn-primary',
        //             click: 'addNew',
        //         }
        //     ],
        //     actions: [
        //         {
        //             key: 'edit',
        //             name: '修改',
        //             class: 'btn-primary',
        //             click: 'editData',
        //         }
        //     ],
        //     editData: function() {
        //         console.log(this.data.listIdx)
        //     },
        //     addNew: function () {
        //         $('#'+this.id).find('form').show();
        //     },
        //     filter: [
        //         {
        //             key: 'sid',
        //             type: 'hidden',
        //             default: 1,
        //         },
        //         {
        //             key: 'sitename',
        //             name: '站点名称',
        //             type: 'text',
        //             default: '',
        //             column: 4,
        //         },
        //     ],
        //     thead:[
        //         {
        //             key: 'id',
        //             name: 'ID',
        //         },
        //         {
        //             key: 'name',
        //             name: '名称',
        //         },
        //         {
        //             key: 'keyword',
        //             name: '关键词',
        //         },
        //         {
        //             key: 'desc',
        //             name: '描述',
        //         },
        //     ],
        // });
    })

</script>